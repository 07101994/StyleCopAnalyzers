<?xml version="1.0" encoding="utf-8"?>
<Project>

  <ItemGroup>
    <!-- Enable code generation for resource files -->
    <CodeGenerationEmbeddedResource Include="@(EmbeddedResource)" Exclude="**\*.??-??.resx" />
    <EmbeddedResource Update="@(CodeGenerationEmbeddedResource)" Generator="ResXFileCodeGenerator" />
  </ItemGroup>

  <!-- Special handling for embedded resources and generated files to show as nested in Solution Explorer -->
  <ItemGroup>
    <!-- Start by removing designer files. Keep track of all the removed ones though. -->
    <RemovedDesignerFiles Include="@(Compile)" />
    <Compile Remove="**\*.Designer.cs" />

    <!-- Add back designer files for *.resx files -->
    <Compile Include="@(CodeGenerationEmbeddedResource->'%(RecursiveDir)%(Filename).Designer.cs')" DependentUpon="$([System.IO.Path]::ChangeExtension($([System.IO.Path]::GetFileNameWithoutExtension(%(Identity))), '.resx'))" />

    <!-- Add back any designer files not already added. These aren't dependent on anything. -->
    <RemovedDesignerFiles Remove="@(Compile)" />
    <Compile Include="@(RemovedDesignerFiles)" />

    <!-- Localized embedded resources are just dependent on the parent RESX -->
    <EmbeddedResource Update="**\*.??-??.resx" DependentUpon="$([System.IO.Path]::ChangeExtension($([System.IO.Path]::GetFileNameWithoutExtension(%(Identity))), '.resx'))" />
  </ItemGroup>

  <ItemGroup>
    <None Include="$(MSBuildProjectFileDirectory)$(AssemblyOriginatorKeyFile)" Link="%(Filename)%(Extension)" />
  </ItemGroup>

</Project>
